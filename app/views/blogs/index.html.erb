<p style="color: green"><%= notice %></p>

<% content_for :title, "Blogs" %>

<h1 style="text-align: center">Blogs</h1>

<!-- Tag Filter Form -->
<div style="text-align: center; margin-bottom: 20px;">
  <%= form_with url: blogs_path, method: :get, local: true do %>
    <%= label_tag :tag_id, "Filter by Tag" %>
    <%= select_tag :tag_id,
          options_from_collection_for_select(Tag.all, :id, :name, params[:tag_id]),
          include_blank: "All Tags" %>
    <%= submit_tag "Filter", class: "btn" %>
  <% end %>
</div>

<!-- Bulk Upload Form -->
<div style="text-align: center; margin-bottom: 20px;">
  <h2>Bulk Upload Blogs via CSV</h2>
  <%= form_with url: bulk_upload_blogs_path, local: true, multipart: true do %>
    <div>
      <%= file_field_tag :file, accept: ".csv" %>
    </div>
    <div style="margin-top: 10px;">
      <%= submit_tag "Upload CSV", class: "btn" %>
    </div>
  <% end %>
</div>

<!-- Blog Cards -->
<div id="blogs" class="blog-cards-container">
  <% @blogs.each do |blog| %>
    <div class="blog-card">
      <h2><%= blog.title %></h2>

      <% if blog.image.attached? %>
        <%= image_tag url_for(blog.image), alt: "Blog Image", class: "blog-image" %>
      <% end %>
      
      <p><%= truncate(blog.description, length: 150) %></p>

      <!-- Display tags with rank -->
      <% blog.blog_tags.order(:rank).each do |bt| %>
        <span class="tag-badge"><%= bt.tag.name %> (Rank: <%= bt.rank %>)</span>
      <% end %>

      <br>
      <%= link_to "Read More", blog_path(blog), class: "btn" %>
    </div>
  <% end %>
</div>

<%= link_to "New blog", new_blog_path, class: "btn", style: "display: inline-block; margin-top: 1rem;" %>
<p><strong>Total Blogs:</strong> <%= Blog.count %></p>
